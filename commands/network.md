# Network

Determine local network. Subnet mask and IP addresses.

`ip a show eth0`

## IPTABLES

`/sbin/iptables-save`

```
INPUT DROP
FORWARD DROP
OUTPUT DROP
-A INPUT -i lo -j ACCEPT
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -o eth0 -p udp -m udp --dport 53 -j ACCEPT
-A OUTPUT -o eth0 -p tcp -m tcp --dport 80 -m state --state NEW -j ACCEPT
-A OUTPUT -o eth0 -p tcp -m tcp --dport 443 -m state --state NEW -j ACCEPT
```

Disable IP6

```
ip6tables -P INPUT DROP
ip6tables -P FORWARD DROP
ip6tables -P OUTPUT DROP
```

## Tools

- [TCPDump](https://www.andreafortuna.org/2018/07/18/tcpdump-a-simple-cheatsheet/)

Check where  DNS goes
```
tcpdump -i any port  53
```

Check `ip6`  leaks
```
tcpdump -i pp0 -vv ip6
```

Examples from external to this device  (traffic not from internal network)
```
tcpdump -i any host  192.168.1.81 and  not  src net 192.168.1.0/24
```

Check for anything coming from external network to this network `192.168.1.0/24`
```
tcpdump -i any dst net 192.168.1.0/24 and not src net 192.168.1.0/24
```

Capture traffic to a file where `65535`  means to capture full packets.
```
tcpdump -i any -s 65535 -w capturefile.cap
```


## SSH

Capture tcp from remote host
```
ssh username@pwd -- "tcpdump -w - -s 65535 'not port 22'" > traffic.pcap
```

Send to wireshark
```
ssh username@pwd tcpdump -U -s 65535 -w - 'not port 22' | wireshark -k -i -;
ssh <user>@<ip-or-dns> tcpdump -U -s 65535 -w - 'host 192.168.1.124 and not port 22' | wireshark -k -i -
```

## IPs

```
ifconfig en0 | grep -i inet
```

