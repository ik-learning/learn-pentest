# Ldap Attacks

- [LDAP Injextion](https://www.owasp.org/index.php/Testing_for_LDAP_Injection_(OTG-INPVAL-006))

## Null Values

Some LDAP servers authorise NULL Bind: if null values are sent, the LDAP server will proceed to bind the connection, and the PHP code will think that the credentials are correct. To get the bind with 2 null values, you will need to completely remove this parameter from the query. If you keep something like username=&password= in the URL, these values will not work, since they won't be null; instead, they will be empty.

Exploration:

```bash
valid $ curl --location --request POST 'http://ptl-4c66bcfc-da2a8f54.libcurl.st/' \
	--form 'usernam=somename' \
	--form 'pwd=wqetrqwet'
attack $ curl --location --request POST 'http://url/'
```

## Injections Attacks

The most common pattern of LDAP injection is to be able to inject in a filter. Here, we will see how you can use LDAP injection to bypass an authentication check.

First, you need to learn a bit of LDAP syntax. When you are retrieving a user, based on its username, the following will be used:

(`cn=[INPUT]`)
If you want to add more conditions and some boolean logic, you can use:

A boolean OR using |: (|(cn=[INPUT1])(cn=[INPUT2])) to get records matching [INPUT1] or [INPUT2].
A boolean AND using &: (&(cn=[INPUT1])(userPassword=[INPUT2])) to get records for which the cn matches [INPUT1] and the password matches [INPUT2].

Our goal here will be to inject inside [INPUT1] (the username parameter). We will need to inject:

- The end of the current filter using `hacker)`.
- An always-true condition (`(cn=*)` for example)
- A `)` to keep a valid syntax and close the first `(`.
- A NULL BYTE (%00) to get rid of the end of the filter.

Exploit:
```
http://url/?name=a*)(cn=*))%00&password=admin
```
