'use strict';

const axios = require("axios"),
  cheerio = require("cheerio"),
  colors = require('colors');

const { url, pwd } = require('./fixtures/mongo-inject');

const fetchData = async () => {
  console.log(`${url.replace(/PWD/g, pwd)}`);
  const result = await axios.get(`${url.replace(/PWD/g, pwd)}`);
  return cheerio.load(result.data);
};

const results = new Set();
const tags = new Set();

const getResults = async () => {
  const $ = await fetchData();

  $(".table.table-striped td a").each((index, element) => {
    results.add({ 'value': $(element).text(), 'pwd': pwd });
  });
  return {
    results: [...results].sort(),
  };
};

void async function () {
  const $ = await getResults();
  console.log($);
  if ($.results.length > 0)
    console.log('next...'.green);
  else
    console.log(`${pwd}, step back...`.red);
}();
